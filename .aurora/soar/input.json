{
  "prompt": "Here are some examples:\n\nQuery: What does the calculate_total function in utils.py do?\n\nDecomposition: {\n  \"goal\": \"Understand the calculate_total function's purpose and behavior\",\n  \"subgoals\": [\n    {\n      \"description\": \"Locate and read calculate_total function in utils.py\",\n      \"ideal_agent\": \"code-developer\",\n      \"ideal_agent_desc\": \"Code reading and function analysis specialist\",\n      \"assigned_agent\": \"code-developer\",\n      \"match_quality\": \"excellent\",\n      \"is_critical\": true,\n      \"depends_on\": []\n    }\n  ],\n  \"execution_order\": [\n    {\n      \"phase\": 1,\n      \"parallelizable\": [\n        0\n      ],\n      \"sequential\": []\n    }\n  ],\n  \"expected_tools\": [\n    \"code_reader\",\n    \"ast_parser\"\n  ]\n}\n\nQuery: Add a new feature to validate email addresses in the user registration flow\n\nDecomposition: {\n  \"goal\": \"Implement email validation in user registration with proper error handling\",\n  \"subgoals\": [\n    {\n      \"description\": \"Analyze existing user registration flow and identify integration points\",\n      \"ideal_agent\": \"code-developer\",\n      \"ideal_agent_desc\": \"Code analysis and flow understanding\",\n      \"assigned_agent\": \"code-developer\",\n      \"match_quality\": \"excellent\",\n      \"is_critical\": true,\n      \"depends_on\": []\n    },\n    {\n      \"description\": \"Create email validation function with regex pattern and domain checks\",\n      \"ideal_agent\": \"code-developer\",\n      \"ideal_agent_desc\": \"Implementation of validation logic\",\n      \"assigned_agent\": \"code-developer\",\n      \"match_quality\": \"excellent\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        0\n      ]\n    },\n    {\n      \"description\": \"Write unit tests for email validation function\",\n      \"ideal_agent\": \"quality-assurance\",\n      \"ideal_agent_desc\": \"Test design and implementation specialist\",\n      \"assigned_agent\": \"quality-assurance\",\n      \"match_quality\": \"excellent\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        1\n      ]\n    },\n    {\n      \"description\": \"Integrate validation into registration form with user-friendly error messages\",\n      \"ideal_agent\": \"code-developer\",\n      \"ideal_agent_desc\": \"Frontend/backend integration\",\n      \"assigned_agent\": \"code-developer\",\n      \"match_quality\": \"excellent\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        1,\n        2\n      ]\n    }\n  ],\n  \"execution_order\": [\n    {\n      \"phase\": 1,\n      \"parallelizable\": [\n        0\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 2,\n      \"parallelizable\": [\n        1\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 3,\n      \"parallelizable\": [\n        2\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 4,\n      \"parallelizable\": [\n        3\n      ],\n      \"sequential\": []\n    }\n  ],\n  \"expected_tools\": [\n    \"code_reader\",\n    \"code_writer\",\n    \"test_runner\",\n    \"file_editor\"\n  ]\n}\n\nQuery: Refactor the payment processing system to support multiple payment providers with retry logic and proper error handling\n\nDecomposition: {\n  \"goal\": \"Design and implement a flexible payment provider abstraction layer with resilience features\",\n  \"subgoals\": [\n    {\n      \"description\": \"Analyze current payment processing implementation and identify tight coupling issues\",\n      \"ideal_agent\": \"system-architect\",\n      \"ideal_agent_desc\": \"System analysis and architecture assessment\",\n      \"assigned_agent\": \"system-architect\",\n      \"match_quality\": \"excellent\",\n      \"is_critical\": true,\n      \"depends_on\": []\n    },\n    {\n      \"description\": \"Audit payment-related security concerns and compliance requirements\",\n      \"ideal_agent\": \"security-expert\",\n      \"ideal_agent_desc\": \"Security auditing and compliance specialist\",\n      \"assigned_agent\": \"code-developer\",\n      \"match_quality\": \"acceptable\",\n      \"is_critical\": true,\n      \"depends_on\": []\n    },\n    {\n      \"description\": \"Design payment provider interface with abstract base class and provider implementations\",\n      \"ideal_agent\": \"system-architect\",\n      \"ideal_agent_desc\": \"Interface and abstraction design\",\n      \"assigned_agent\": \"system-architect\",\n      \"match_quality\": \"excellent\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        0,\n        1\n      ]\n    },\n    {\n      \"description\": \"Implement retry logic with exponential backoff and circuit breaker pattern\",\n      \"ideal_agent\": \"code-developer\",\n      \"ideal_agent_desc\": \"Resilience pattern implementation\",\n      \"assigned_agent\": \"code-developer\",\n      \"match_quality\": \"excellent\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        2\n      ]\n    },\n    {\n      \"description\": \"Create comprehensive error handling with specific exception types and recovery strategies\",\n      \"ideal_agent\": \"code-developer\",\n      \"ideal_agent_desc\": \"Error handling and exception design\",\n      \"assigned_agent\": \"code-developer\",\n      \"match_quality\": \"excellent\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        2\n      ]\n    },\n    {\n      \"description\": \"Update existing code to use new provider abstraction layer\",\n      \"ideal_agent\": \"code-developer\",\n      \"ideal_agent_desc\": \"Code refactoring and migration\",\n      \"assigned_agent\": \"code-developer\",\n      \"match_quality\": \"excellent\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        3,\n        4\n      ]\n    },\n    {\n      \"description\": \"Write integration tests for each payment provider with mocked responses\",\n      \"ideal_agent\": \"quality-assurance\",\n      \"ideal_agent_desc\": \"Integration testing and test architecture\",\n      \"assigned_agent\": \"quality-assurance\",\n      \"match_quality\": \"excellent\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        5\n      ]\n    },\n    {\n      \"description\": \"Update API documentation with new payment flow and error codes\",\n      \"ideal_agent\": \"technical-writer\",\n      \"ideal_agent_desc\": \"API documentation specialist\",\n      \"assigned_agent\": \"code-developer\",\n      \"match_quality\": \"acceptable\",\n      \"is_critical\": false,\n      \"depends_on\": [\n        5\n      ]\n    }\n  ],\n  \"execution_order\": [\n    {\n      \"phase\": 1,\n      \"parallelizable\": [\n        0,\n        1\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 2,\n      \"parallelizable\": [\n        2\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 3,\n      \"parallelizable\": [\n        3,\n        4\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 4,\n      \"parallelizable\": [\n        5\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 5,\n      \"parallelizable\": [\n        6,\n        7\n      ],\n      \"sequential\": []\n    }\n  ],\n  \"expected_tools\": [\n    \"code_reader\",\n    \"code_writer\",\n    \"ast_parser\",\n    \"test_runner\",\n    \"security_audit\",\n    \"doc_generator\"\n  ]\n}\n\nQuery: Migrate the entire application from monolithic architecture to microservices with minimal downtime\n\nDecomposition: {\n  \"goal\": \"Execute phased microservices migration with zero-downtime deployment and rollback capability\",\n  \"subgoals\": [\n    {\n      \"description\": \"Perform comprehensive dependency analysis of current monolith to identify service boundaries\",\n      \"ideal_agent\": \"system-architect\",\n      \"ideal_agent_desc\": \"Dependency analysis and service boundary identification\",\n      \"assigned_agent\": \"system-architect\",\n      \"match_quality\": \"excellent\",\n      \"is_critical\": true,\n      \"depends_on\": []\n    },\n    {\n      \"description\": \"Audit data flow and database dependencies to plan data migration strategy\",\n      \"ideal_agent\": \"data-architect\",\n      \"ideal_agent_desc\": \"Database and data flow analysis specialist\",\n      \"assigned_agent\": \"system-architect\",\n      \"match_quality\": \"acceptable\",\n      \"is_critical\": true,\n      \"depends_on\": []\n    },\n    {\n      \"description\": \"Security assessment of API boundaries and authentication/authorization requirements\",\n      \"ideal_agent\": \"security-expert\",\n      \"ideal_agent_desc\": \"Security architecture and API security specialist\",\n      \"assigned_agent\": \"code-developer\",\n      \"match_quality\": \"acceptable\",\n      \"is_critical\": true,\n      \"depends_on\": []\n    },\n    {\n      \"description\": \"Design microservices architecture with service contracts and communication patterns\",\n      \"ideal_agent\": \"system-architect\",\n      \"ideal_agent_desc\": \"Microservices architecture design\",\n      \"assigned_agent\": \"system-architect\",\n      \"match_quality\": \"excellent\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        0,\n        1,\n        2\n      ]\n    },\n    {\n      \"description\": \"Create deployment pipeline and infrastructure-as-code for each microservice\",\n      \"ideal_agent\": \"devops-engineer\",\n      \"ideal_agent_desc\": \"CI/CD and infrastructure automation specialist\",\n      \"assigned_agent\": \"code-developer\",\n      \"match_quality\": \"acceptable\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        3\n      ]\n    },\n    {\n      \"description\": \"Implement strangler fig pattern to gradually replace monolith components\",\n      \"ideal_agent\": \"code-developer\",\n      \"ideal_agent_desc\": \"Migration pattern implementation\",\n      \"assigned_agent\": \"code-developer\",\n      \"match_quality\": \"excellent\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        4\n      ]\n    },\n    {\n      \"description\": \"Build comprehensive monitoring and observability with distributed tracing\",\n      \"ideal_agent\": \"devops-engineer\",\n      \"ideal_agent_desc\": \"Observability and monitoring specialist\",\n      \"assigned_agent\": \"code-developer\",\n      \"match_quality\": \"acceptable\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        5\n      ]\n    },\n    {\n      \"description\": \"Create rollback procedures and disaster recovery plan\",\n      \"ideal_agent\": \"devops-engineer\",\n      \"ideal_agent_desc\": \"Disaster recovery and rollback planning\",\n      \"assigned_agent\": \"system-architect\",\n      \"match_quality\": \"acceptable\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        5,\n        6\n      ]\n    },\n    {\n      \"description\": \"Execute phased migration with canary deployments and traffic shifting\",\n      \"ideal_agent\": \"devops-engineer\",\n      \"ideal_agent_desc\": \"Deployment orchestration specialist\",\n      \"assigned_agent\": \"code-developer\",\n      \"match_quality\": \"acceptable\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        6,\n        7\n      ]\n    },\n    {\n      \"description\": \"Validate system performance and conduct load testing for each phase\",\n      \"ideal_agent\": \"quality-assurance\",\n      \"ideal_agent_desc\": \"Performance testing and validation specialist\",\n      \"assigned_agent\": \"quality-assurance\",\n      \"match_quality\": \"excellent\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        8\n      ]\n    }\n  ],\n  \"execution_order\": [\n    {\n      \"phase\": 1,\n      \"parallelizable\": [\n        0,\n        1,\n        2\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 2,\n      \"parallelizable\": [\n        3\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 3,\n      \"parallelizable\": [\n        4\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 4,\n      \"parallelizable\": [\n        5\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 5,\n      \"parallelizable\": [\n        6,\n        7\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 6,\n      \"parallelizable\": [\n        8\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 7,\n      \"parallelizable\": [\n        9\n      ],\n      \"sequential\": []\n    }\n  ],\n  \"expected_tools\": [\n    \"dependency_analyzer\",\n    \"code_reader\",\n    \"security_audit\",\n    \"infrastructure_provisioner\",\n    \"deployment_manager\",\n    \"test_runner\",\n    \"monitoring_setup\"\n  ]\n}\n\n---\n\nQuery: how can i improve aur mem search speed?\n\nRelevant Context Summary:\nNo indexed context available. Using LLM general knowledge.\n\nAvailable Agents: 1-create-prd, 2-generate-tasks, 3-process-task-list, code-developer, context-builder, feature-planner, market-researcher, orchestrator, quality-assurance, system-architect, ui-designer\n\nDecompose this query into actionable subgoals in JSON format.",
  "system": "You are a query decomposition expert for a code reasoning system.\n\nYour task is to break down complex queries into concrete, actionable subgoals that can be\nexecuted by specialized agents.\n\nFor each subgoal, specify:\n1. A clear, specific goal statement (what needs to be done)\n2. The IDEAL agent (unconstrained - what specialist SHOULD handle this)\n3. A brief description of the ideal agent's capabilities\n4. The ASSIGNED agent (from available list - best available match)\n5. MATCH QUALITY - how well the assigned agent fits this task\n6. Whether the subgoal is critical to the overall query\n7. Dependencies on other subgoals (by index)\n\nAvailable agents with capabilities:\n  - 1-create-prd: general capabilities\n  - 2-generate-tasks: general capabilities\n  - 3-process-task-list: general capabilities\n  - code-developer: code implementation, debugging, refactoring, API development\n  - context-builder: general capabilities\n  - feature-planner: PRD creation, product strategy, feature prioritization, roadmap planning\n  - market-researcher: market research, competitive analysis, brainstorming, project discovery\n  - orchestrator: general capabilities\n  - quality-assurance: test architecture, test strategy, quality assessment, test design\n  - system-architect: system design, architecture, API design, infrastructure planning\n  - ui-designer: UI/UX design, wireframes, prototypes, user experience\n\nFor each subgoal, specify TWO agents:\n1. ideal_agent: The IDEAL agent for this task (any name, even if not available)\n2. assigned_agent: The BEST AVAILABLE agent from the list above\n\nMATCH QUALITY RULES:\n- \"excellent\": Assign when task matches agent's SPECIALTIES\n  Examples: @quality-assurance for testing, @system-architect for design\n- \"acceptable\": Assign when agent CAN HANDLE the task but isn't specialized\n  Examples: @code-developer for documentation, @market-researcher for basic research\n- \"insufficient\": Assign when no agent is capable, using @master as fallback\n  Examples: @master for creative writing, @master for video editing\n\nCommon ideal agents to consider (even if not available):\n- creative-writer: story editing, narrative, creative writing\n- data-analyst: data analysis, visualization, statistics, ML\n- ux-designer: UI/UX design, wireframes, prototypes\n- devops-engineer: CI/CD, infrastructure, deployment, monitoring\n- security-expert: security audits, vulnerability analysis, compliance\n- technical-writer: documentation, API docs, user guides\n\nYou MUST respond with valid JSON only. Use this exact schema:\n{\n  \"goal\": \"High-level goal summarizing what we're trying to achieve\",\n  \"subgoals\": [\n    {\n      \"description\": \"Specific subgoal description\",\n      \"ideal_agent\": \"agent-that-should-handle-this\",\n      \"ideal_agent_desc\": \"Brief description of ideal agent capabilities\",\n      \"assigned_agent\": \"best-available-agent\",\n      \"match_quality\": \"excellent | acceptable | insufficient\",\n      \"is_critical\": true/false,\n      \"depends_on\": [0, 1]  // indices of prerequisite subgoals\n    }\n  ],\n  \"execution_order\": [\n    {\n      \"phase\": 1,\n      \"parallelizable\": [0, 1],  // subgoal indices that can run in parallel\n      \"sequential\": [2]  // subgoals that must run after this phase\n    }\n  ],\n  \"expected_tools\": [\"list\", \"of\", \"expected\", \"tool\", \"types\"]\n}\n\nYou MUST respond with valid JSON only. Do not include markdown code blocks, explanations, or any text outside the JSON object.",
  "phase": "unknown",
  "tool": "claude"
}